<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Desaster Dodge 2D</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; font-family: 'Segoe UI', sans-serif; color: white; }
        canvas { display: block; background: #000; margin: auto; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .menu { background: rgba(0, 0, 0, 0.85); padding: 30px; border-radius: 15px; text-align: center; border: 2px solid #444; min-width: 300px; }
        
        button { background: #e67e22; border: none; padding: 12px 25px; color: white; font-size: 18px; margin: 10px; cursor: pointer; border-radius: 5px; transition: 0.3s; width: 200px; }
        button:hover { background: #d35400; transform: scale(1.05); }
        button.locked { background: #555; cursor: not-allowed; }
        
        .stats { position: absolute; top: 20px; left: 20px; font-size: 20px; pointer-events: none; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="stats" id="game-stats">Score: 0</div>

    <div id="ui-layer">
        <!-- Hauptmen√º -->
        <div id="main-menu" class="menu">
            <h1>Desaster Dodge</h1>
            <button onclick="showMenu('mode-menu')">Spielen</button>
            <button onclick="showMenu('skin-menu')">Skins</button>
        </div>

        <!-- Modus-Auswahl -->
        <div id="mode-menu" class="menu hidden">
            <h2>Modus w√§hlen</h2>
            <button onclick="startGame('sandstorm')">Sandsturm</button>
            <button onclick="startGame('meteors')">Meteoritenschauer</button>
            <button onclick="showMenu('main-menu')">Zur√ºck</button>
        </div>

        <!-- Skin-Men√º -->
        <div id="skin-menu" class="menu hidden">
            <h2>Skins</h2>
            <div id="skin-list"></div>
            <button onclick="showMenu('main-menu')">Zur√ºck</button>
        </div>

        <!-- Game Over -->
        <div id="game-over" class="menu hidden">
            <h1 style="color: #e74c3c;">GAME OVER</h1>
            <p id="final-score"></p>
            <button onclick="showMenu('mode-menu')">Nochmal</button>
            <button onclick="showMenu('main-menu')">Men√º</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const uiLayer = document.getElementById('ui-layer');
    const stats = document.getElementById('game-stats');

    // Spiel-Konfiguration
    let gameActive = false;
    let score = 0;
    let highScore = localStorage.getItem('highScore') || 0;
    let currentMode = 'sandstorm';
    let player = { x: 0, y: 0, w: 40, h: 40, color: '#3498db', speed: 7 };
    let obstacles = [];
    let particles = [];
    
    // Skins & Achievements
    const skins = [
        { id: 'blue', name: 'Standard Blau', color: '#3498db', req: 0, unlocked: true },
        { id: 'gold', name: 'Gold (Score 500)', color: '#f1c40f', req: 500, unlocked: false },
        { id: 'neon', name: 'Neon (Score 1500)', color: '#2ecc71', req: 1500, unlocked: false }
    ];
    let selectedSkin = skins[0];

    function init() {
        canvas.width = 600;
        canvas.height = window.innerHeight;
        player.x = canvas.width / 2 - 20;
        player.y = canvas.height - 80;
        checkAchievements();
        renderSkins();
    }

    // Input Handling
    let keys = {};
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    function showMenu(id) {
        document.querySelectorAll('.menu').forEach(m => m.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        gameActive = false;
    }

    function renderSkins() {
        const list = document.getElementById('skin-list');
        list.innerHTML = '';
        skins.forEach(skin => {
            const btn = document.createElement('button');
            const isLocked = highScore < skin.req;
            btn.innerHTML = isLocked ? `üîí ${skin.name}` : skin.name;
            btn.className = isLocked ? 'locked' : '';
            btn.style.borderLeft = `10px solid ${skin.color}`;
            btn.onclick = () => { if(!isLocked) { selectedSkin = skin; player.color = skin.color; showMenu('main-menu'); }};
            list.appendChild(btn);
        });
    }

    function checkAchievements() {
        skins.forEach(s => { if(highScore >= s.req) s.unlocked = true; });
    }

    function startGame(mode) {
        currentMode = mode;
        score = 0;
        obstacles = [];
        particles = [];
        gameActive = true;
        uiLayer.classList.add('hidden');
        stats.classList.remove('hidden');
        requestAnimationFrame(gameLoop);
    }

    function spawnObstacle() {
        let size = Math.random() * 30 + 20;
        let obj = {
            x: Math.random() * (canvas.width - size),
            y: -size,
            w: size,
            h: size,
            speed: Math.random() * 3 + 4 + (score / 500),
            color: currentMode === 'sandstorm' ? '#d35400' : '#7f8c8d'
        };
        obstacles.push(obj);
    }

    function gameLoop() {
        if (!gameActive) return;

        // Hintergrund & Effekte
        ctx.fillStyle = currentMode === 'sandstorm' ? '#3e2723' : '#0d0d0d';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Sandsturm-Partikel Effekt
        if (currentMode === 'sandstorm') {
            ctx.fillStyle = 'rgba(230, 126, 34, 0.1)';
            for(let i=0; i<5; i++) ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, 2, 2);
        }

        // Steuerung
        if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
        if (keys['ArrowRight'] && player.x < canvas.width - player.w) player.x += player.speed;

        // Spieler zeichnen (mit Glow)
        ctx.shadowBlur = 15;
        ctx.shadowColor = player.color;
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.w, player.h);
        ctx.shadowBlur = 0;

        // Hindernisse bewegen
        if (Math.random() < 0.05) spawnObstacle();

        for (let i = obstacles.length - 1; i >= 0; i--) {
            let o = obstacles[i];
            o.y += o.speed;
            
            // Zeichnen
            ctx.fillStyle = o.color;
            if(currentMode === 'meteors') {
                ctx.beginPath();
                ctx.arc(o.x + o.w/2, o.y + o.h/2, o.w/2, 0, Math.PI*2);
                ctx.fill();
            } else {
                ctx.fillRect(o.x, o.y, o.w, o.h);
            }

            // Kollision
            if (player.x < o.x + o.w && player.x + player.w > o.x &&
                player.y < o.y + o.h && player.y + player.h > o.y) {
                gameOver();
            }

            if (o.y > canvas.height) {
                obstacles.splice(i, 1);
                score += 10;
            }
        }

        score++;
        stats.innerText = `Score: ${Math.floor(score/10)}`;
        requestAnimationFrame(gameLoop);
    }

    function gameOver() {
        gameActive = false;
        let finalScore = Math.floor(score/10);
        if(finalScore > highScore) {
            highScore = finalScore;
            localStorage.setItem('highScore', highScore);
        }
        document.getElementById('final-score').innerText = `Dein Score: ${finalScore} (Best: ${highScore})`;
        uiLayer.classList.remove('hidden');
        showMenu('game-over');
        checkAchievements();
        renderSkins();
    }

    window.addEventListener('resize', init);
    init();

</script>
</body>
</html>

